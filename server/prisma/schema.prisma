// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  email         String         @unique
  firstName     String
  lastName      String
  passwordHash  String
  lmsUserId     String?        @unique
  lmsEmail      String?
  refreshTokens RefreshToken[]
  userRoles     UserRole[]
}

model RefreshToken {
  id     Int  @id @default(autoincrement())
  user   User @relation(fields: [userId], references: [id])
  userId Int
}

enum RoleKey {
  ADMIN
  USER
  SYS_SYSADMIN
  SYS_SUPPORT
  SYS_CREATOR
  SYS_ACCOUNTADMIN
  SYS_USER
  SYS_ADMINISTRATOR
  SYS_NONE
  // institutional roles
  INST_STUDENT
  INST_FACULTY
  INST_MEMBER
  INST_LEARNER
  INST_INSTRUCTOR
  INST_MENTOR
  INST_STAFF
  INST_ALUMNI
  INST_PROSPECTIVESTUDENT
  INST_GUEST
  INST_OTHER
  INST_ADMINISTRATOR
  INST_OBSERVER
  INST_NONE
  // context roles
  CONTEXT_LEARNER
  CONTEXT_LEARNER_LEARNER
  CONTEXT_LEARNER_NONCREDITLEARNER
  CONTEXT_LEARNER_GUESTLEARNER
  CONTEXT_LEARNER_EXTERNALLECTURER
  CONTEXT_LEARNER_INSTRUCTOR
  CONTEXT_INSTRUCTOR
  CONTEXT_INSTRUCTOR_PRIMARYINSTRUCTOR
  CONTEXT_INSTRUCTOR_LECTURER
  CONTEXT_INSTRUCTOR_GUESTINSTRUCTOR
  CONTEXT_INSTRUCTOR_EXTERNALINSTRUCTOR
  CONTEXT_CONTENT_DEVELOPER
  CONTEXT_CONTENT_DEVELOPER_CONTENT_DEVELOPER
  CONTEXT_CONTENT_DEVELOPER_LIBRARIAN
  CONTEXT_CONTENT_DEVELOPER_CONTENTEXPERT
  CONTEXT_CONTENT_DEVELOPER_EXTERNALCONTENTEXPERT
  CONTEXT_MEMBER
  CONTEXT_MEMBER_MEMBER
  CONTEXT_MANAGER
  CONTEXT_MANAGER_AREAMANAGER
  CONTEXT_MANAGER_COURSECOORDINATOR
  CONTEXT_MANAGER_OBSERVER
  CONTEXT_MANAGER_EXTERNALOBSERVER
  CONTEXT_MENTOR
  CONTEXT_MENTOR_MENTOR
  CONTEXT_MENTOR_REVIEWER
  CONTEXT_MENTOR_ADVISOR
  CONTEXT_MENTOR_AUDITOR
  CONTEXT_MENTOR_TUTOR
  CONTEXT_MENTOR_LEARNINGFACILITATOR
  CONTEXT_MENTOR_EXTERNALMENTOR
  CONTEXT_MENTOR_EXTERNALREVIEWER
  CONTEXT_MENTOR_EXTERNALADVISOR
  CONTEXT_MENTOR_EXTERNALAUDITOR
  CONTEXT_MENTOR_EXTERNALTUTUR
  CONTEXT_MENTOR_EXTERNALLEARNINGFACILITATOR
  CONTEXT_ADMINISTRATOR
  CONTEXT_ADMINISTRATOR_ADMINISTRATOR
  CONTEXT_ADMINISTRATOR_SUPPORT
  CONTEXT_ADMINISTRATOR_DEVELOPER
  CONTEXT_ADMINISTRATOR_SYSTEMADMINISTRATOR
  CONTEXT_ADMINISTRATOR_EXTERNALSYSTEMADMINISTRATOR
  CONTEXT_ADMINISTRATOR_EXTERNALDEVELOPER
  CONTEXT_ADMINISTRATOR_EXTERNALSUPPORT
  CONTEXT_TEACHINGASSISTANT
  CONTEXT_TEACHINGASSISTANT_TEACHINGASSISTANT
  CONTEXT_TEACHINGASSISTANT_TEACHINGASSISTANTSECTION
  CONTEXT_TEACHINGASSISTANT_TEACHINGASSISTANTSECTIONASSOCIATION
  CONTEXT_TEACHINGASSISTANT_TEACHINGASSISTANTOFFERING
  CONTEXT_TEACHINGASSISTANT_TEACHINGASSISTANTTEMPLATE
  CONTEXT_TEACHINGASSISTANT_TEACHINGASSISTANTGROUP
  CONTEXT_TEACHINGASSISTANT_GRADER
}

model Role {
  id        Int        @id @default(autoincrement())
  roleKey   RoleKey    @unique
  userRoles UserRole[]
}

model UserRole {
  id        Int    @id @default(autoincrement())
  contextId String
  user      User   @relation(fields: [userId], references: [id])
  userId    Int
  role      Role   @relation(fields: [roleId], references: [id])
  roleId    Int
}

model LTILaunch {
  id     Int    @id @default(autoincrement())
  token  String @unique
  config Json
}

model Nonce {
  id    Int    @id @default(autoincrement())
  nonce String @unique
}
